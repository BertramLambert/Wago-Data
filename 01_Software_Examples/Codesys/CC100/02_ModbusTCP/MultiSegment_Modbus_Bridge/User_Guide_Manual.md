# User Guide: MultiSegment_Modbus_Bridge (Data Bridge Mode)

> [!TIP]
> **Technical Document Info:**
> ![Device](https://img.shields.io/badge/Device-WAGO%20CC100--751--9301-ee0000) ![Feature](https://img.shields.io/badge/Feature-Dual--Network--Bridge-blue) ![Protocol](https://img.shields.io/badge/Protocol-Modbus%20TCP-orange) ![Status](https://img.shields.io/badge/Status-Implemented-brightgreen)

---

## ðŸ“– ç›®éŒ„ (Table of Contents)
- [User Guide: MultiSegment\_Modbus\_Bridge (Data Bridge Mode)](#user-guide-multisegment_modbus_bridge-data-bridge-mode)
  - [ðŸ“– ç›®éŒ„ (Table of Contents)](#-ç›®éŒ„-table-of-contents)
  - [1. å°ˆæ¡ˆæ ¸å¿ƒæž¶æ§‹ (Core Architecture)](#1-å°ˆæ¡ˆæ ¸å¿ƒæž¶æ§‹-core-architecture)
  - [2. ç¡¬é«”é…ç½®ï¼šé›™ç¶²å£ç¨ç«‹è¨­å®š (Dual Port Setup)](#2-ç¡¬é«”é…ç½®é›™ç¶²å£ç¨ç«‹è¨­å®š-dual-port-setup)
    - [ðŸŒ ç¶²è·¯åŸ åˆ†é…](#-ç¶²è·¯åŸ åˆ†é…)
    - [âš™ï¸ è¨­å®šé‡é»ž](#ï¸-è¨­å®šé‡é»ž)
  - [3. ç¨‹å¼é‚è¼¯ï¼šå¡«è¡¨å¼è³‡æ–™è½‰ç™¼ (Table-Driven Logic)](#3-ç¨‹å¼é‚è¼¯å¡«è¡¨å¼è³‡æ–™è½‰ç™¼-table-driven-logic)
    - [åŸ·è¡Œæ­¥é©Ÿï¼š](#åŸ·è¡Œæ­¥é©Ÿ)
  - [4. è³‡æ–™æ˜ å°„èˆ‡å½™æ•´ (Data Mapping)](#4-è³‡æ–™æ˜ å°„èˆ‡å½™æ•´-data-mapping)
  - [5. æ•…éšœæŽ’é™¤èˆ‡ç¶­ä¿® (Troubleshooting)](#5-æ•…éšœæŽ’é™¤èˆ‡ç¶­ä¿®-troubleshooting)

---

## 1. å°ˆæ¡ˆæ ¸å¿ƒæž¶æ§‹ (Core Architecture)
æœ¬å°ˆæ¡ˆå°‡ **WAGO CC100** å®šç¾©ç‚ºæ•¸æ“šä¸­ç¹¼æ©‹æŽ¥å™¨ã€‚åˆ©ç”¨å…¶é›™ä¹™å¤ªç¶²è·¯å­”çš„ç‰¹æ€§ï¼Œé”æˆè·¨ç¶²æ®µçš„è³‡æ–™æŽ¡é›†èˆ‡åŒæ­¥ï¼š

* **ä¾†æºç«¯ (Field Segment)**ï¼šé€éŽç¬¬ä¸€å€‹ç¶²å­”èˆ‡ç¾å ´è¨­å‚™é€šè¨Šï¼Œè®€å–åŽŸå§‹æ•¸æ“šã€‚
* **æ•¸æ“šä¸­è½‰ (PLC Logic)**ï¼šåœ¨ç¨‹å¼å…§éƒ¨å»ºç«‹ç·©è¡è¡¨ï¼ˆArrayï¼‰ï¼Œå°è³‡æ–™é€²è¡Œæ¸…æ´—èˆ‡æŽ’ç‰ˆã€‚
* **ç›®æ¨™ç«¯ (Host Segment)**ï¼šå°‡æ•´ç†å¾Œçš„ç·©è¡è¡¨é€éŽç¬¬äºŒå€‹ç¶²å­”å¯«å…¥è‡³å¦ä¸€å° PLCã€‚



---

## 2. ç¡¬é«”é…ç½®ï¼šé›™ç¶²å£ç¨ç«‹è¨­å®š (Dual Port Setup)

ç‚ºäº†é”æˆç‰©ç†éš”é›¢èˆ‡è·¨ç¶²æ®µå‚³è¼¸ï¼Œéœ€åœ¨ **WAGO Web-Based Management (WBM)** èˆ‡ **CODESYS è£ç½®æ¨¹** é€²è¡Œä»¥ä¸‹é…ç½®ï¼š

### ðŸŒ ç¶²è·¯åŸ åˆ†é…
* **Ethernet (Port 1)**: é€£æŽ¥ç¾å ´ Modbus TCP Slave è¨­å‚™ï¼ˆä¾‹å¦‚ï¼šæ„Ÿæ¸¬å™¨ã€æµé‡è¨ˆï¼‰ã€‚
* **Ethernet_1 (Port 2)**: é€£æŽ¥ä¸Šå±¤ç³»çµ±æˆ–å…¶ä»– PLC ç«™é»žã€‚

### âš™ï¸ è¨­å®šé‡é»ž
1.  **IP åˆ†é…**: ç¢ºä¿å…©å€‹ç¶²å­”ä½æ–¼ä¸åŒçš„å­ç¶²æ®µï¼ˆSubnetï¼‰ï¼Œé¿å…è·¯ç”±è¡çªã€‚
2.  **Modbus Master æŽ›è¼‰**: åœ¨ CODESYS çš„ `Devices` æ¨¹ç‹€åœ–ä¸­ï¼Œå°‡æŽ¡é›†ç”¨çš„ Master æŽ›åœ¨ç¬¬ä¸€å€‹ç¶²å­”ï¼Œè½‰ç™¼ç”¨çš„ Master æŽ›åœ¨ç¬¬äºŒå€‹ç¶²å­”ã€‚



---

## 3. ç¨‹å¼é‚è¼¯ï¼šå¡«è¡¨å¼è³‡æ–™è½‰ç™¼ (Table-Driven Logic)

æœ¬ç¨‹å¼çš„æ ¸å¿ƒåœ¨æ–¼ **ã€Œå¡«è¡¨ (Mapping)ã€**ï¼Œè€Œéžå–®ç´”çš„é€æ˜Žå‚³è¼¸ã€‚

### åŸ·è¡Œæ­¥é©Ÿï¼š
1.  **åˆ†æ•£æŽ¡é›†**: é€éŽå¤šå€‹ Modbus è®€å–ä»»å‹™ï¼Œå°‡è³‡æ–™åˆ†åˆ¥å­˜å…¥æœ¬åœ°è®Šæ•¸ï¼ˆå¦‚ `wTemp_01`, `wHumi_02`ï¼‰ã€‚
2.  **è³‡æ–™å½™æ•´**: ä½¿ç”¨ç¨‹å¼é‚è¼¯ï¼ˆå¦‚ `FOR` è¿´åœˆæˆ–ç›´æŽ¥è³¦å€¼ï¼‰å°‡é€™äº›åˆ†æ•£è®Šæ•¸å¯«å…¥äºŒç¶­é™£åˆ— `aLogData`ã€‚
3.  **æ‰¹é‡ç™¼é€**: å‘¼å«å¯«å…¥åŠŸèƒ½å¡Šï¼Œå°‡æ•´ä»½ `aLogData` è¡¨å–®ä¸€æ¬¡æ€§å¯«å…¥ç›®æ¨™ PLC çš„æŒ‡å®šä½å€ã€‚

---

## 4. è³‡æ–™æ˜ å°„èˆ‡å½™æ•´ (Data Mapping)

äºŒç¶­é™£åˆ—ï¼ˆTableï¼‰çš„è¨­è¨ˆé‚è¼¯ç¢ºä¿äº†è³‡æ–™åœ¨å‚³è¼¸éŽç¨‹ä¸­çš„æ•´æ½”æ€§ï¼š

| é™£åˆ—ç´¢å¼• (Index) | Column 0 (ä¾†æºç¶²æ®µ A) | Column 1 (ä¾†æºç¶²æ®µ B) |
| :---: | :--- | :--- |
| **0** | æº«åº¦æ„Ÿæ¸¬å™¨ 01 | æ¿•åº¦æ„Ÿæ¸¬å™¨ 01 |
| **1** | æº«åº¦æ„Ÿæ¸¬å™¨ 02 | æ¿•åº¦æ„Ÿæ¸¬å™¨ 02 |
| **...** | ... | ... |
| **9** | ç¬¬ 10 çµ„æŽ¡é›†æ•¸æ“š | ç¬¬ 10 çµ„æŽ¡é›†æ•¸æ“š |

---

## 5. æ•…éšœæŽ’é™¤èˆ‡ç¶­ä¿® (Troubleshooting)

| ç¾è±¡ | å¯èƒ½åŽŸå›  | æª¢æŸ¥é …ç›® |
| :--- | :--- | :--- |
| **ç›®æ¨™ PLC æ²’æ”¶åˆ°è³‡æ–™** | ç¶²å­” 2 çš„ IP è¨­å®šéŒ¯èª¤æˆ– Gateway ä¸é€š | æª¢æŸ¥ WBM ä¸­ Ethernet_1 çš„è¨­å®šèˆ‡ Ping ç‹€æ…‹ã€‚ |
| **è³‡æ–™é †åºéŒ¯èª¤** | å¡«è¡¨è¿´åœˆæŒ‡æ¨™ `i` é‚è¼¯æœ‰èª¤ | æª¢æŸ¥ `PLC_PRG` ä¸­å° `aLogData` çš„è³¦å€¼é †åºã€‚ |
| **é€šè¨Šå»¶é²é«˜** | å…©ç¶²æ®µåŒæ™‚è®€å¯«é »çŽ‡éŽå¿« | å»ºè­°å¢žåŠ ä»»å‹™é–“çš„é–“éš”æ™‚é–“ (Gap Time)ã€‚ |

---

> **Project:** MultiSegment_Modbus_Bridge  
> **Hardware:** WAGO CC100-751-9301